<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid Test 2 - Debug Specific Diagram</title>
    <meta name="robots" content="noindex">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            margin: 0;
            padding: 24px;
            background: #f5f7fb;
            color: #111827;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        h1 {
            margin: 0 0 8px;
            font-size: 24px;
        }
        .card {
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.04);
        }
        .mermaid-wrap {
            background:#fff;
            border:1px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            overflow: visible;
        }
        .mermaid {
            width: 100% !important;
            display: block !important;
            text-align: center;
        }
        .mermaid svg {
            width: 100% !important;
            height: auto !important;
            max-width: 100% !important;
            display: block !important;
        }
        .test-info {
            background: #eff6ff;
            border: 1px solid #93c5fd;
            border-radius: 8px;
            padding: 12px;
            margin: 16px 0;
            font-size: 14px;
        }
        .console-log {
            background: #1f2937;
            color: #f9fafb;
            padding: 12px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            margin: 16px 0;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@11.3.0/dist/mermaid.min.js"></script>
    <script>
        // Console capture for debugging
        const logs = [];
        const originalLog = console.log;
        console.log = function(...args) {
            logs.push(args.join(' '));
            originalLog.apply(console, arguments);
            updateLogDisplay();
        };

        function updateLogDisplay() {
            const logDiv = document.getElementById('console-logs');
            if (logDiv) {
                logDiv.innerHTML = logs.slice(-10).join('<br>');
                logDiv.scrollTop = logDiv.scrollHeight;
            }
        }

        // Test 1: Minimal config
        mermaid.initialize({
            startOnLoad: true,
            fontSize: 16,
            securityLevel: 'loose',
            theme: 'base',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true
            }
        });

        window.addEventListener('load', function() {
            console.log('Page loaded, checking SVGs...');

            setTimeout(() => {
                const svgs = document.querySelectorAll('.mermaid svg');
                console.log(`Found ${svgs.length} SVGs`);

                svgs.forEach((svg, i) => {
                    const viewBox = svg.getAttribute('viewBox');
                    const width = svg.getAttribute('width');
                    const height = svg.getAttribute('height');

                    console.log(`SVG ${i+1}: width=${width}, height=${height}, viewBox=${viewBox}`);

                    // Test different sizing approaches
                    if (i === 0) {
                        // Test 1: Keep original
                        console.log('Test 1: Keeping original size');
                    } else if (i === 1) {
                        // Test 2: Force width 600px
                        svg.removeAttribute('width');
                        svg.removeAttribute('height');
                        svg.style.width = '600px';
                        svg.style.height = 'auto';
                        console.log('Test 2: Set width 600px, height auto');
                    } else if (i === 2) {
                        // Test 3: Force 600x400
                        svg.removeAttribute('width');
                        svg.removeAttribute('height');
                        svg.style.width = '600px';
                        svg.style.height = '400px';
                        console.log('Test 3: Set 600x400 fixed');
                    } else if (i === 3) {
                        // Test 4: Smart sizing based on viewBox
                        if (viewBox) {
                            const [x, y, w, h] = viewBox.split(' ').map(Number);
                            const aspectRatio = w / h;
                            let newWidth = 600;
                            let newHeight = Math.round(600 / aspectRatio);

                            svg.removeAttribute('width');
                            svg.removeAttribute('height');
                            svg.style.width = newWidth + 'px';
                            svg.style.height = newHeight + 'px';
                            console.log(`Test 4: Smart size ${newWidth}x${newHeight} (aspect: ${aspectRatio.toFixed(2)})`);
                        }
                    }
                });

                updateLogDisplay();
            }, 500);
        });
    </script>
</head>
<body>
    <div class="container">
        <h1>Mermaid Test 2 - Debug Specific Diagram</h1>

        <div class="test-info">
            <strong>Goal:</strong> Debug why the Reference Rules Between Layers diagram renders small.
            Testing 4 different sizing approaches on the same diagram.
        </div>

        <div class="console-log" id="console-logs">Console logs will appear here...</div>

        <div class="card">
            <strong>Test 1: Original (no changes)</strong>
            <div class="mermaid-wrap">
                <div class="mermaid">
flowchart BT
    S[Bootstrap Layer]
    O[Operators Layer]
    I[Implementations]
    B[Boundary Layer]
    C[Core Abstractions]

    O --> B
    O --> C
    I --> C
    S --> O
    S --> I

    style C fill:#fff7ed,stroke:#c2410c,stroke-width:2px
    style B fill:#eff6ff,stroke:#1d4ed8,stroke-width:2px
    style O fill:#f0fdf4,stroke:#16a34a,stroke-width:2px
    style I fill:#fef3c7,stroke:#d97706,stroke-width:2px
    style S fill:#f3e8ff,stroke:#9333ea,stroke-width:2px
                </div>
            </div>
        </div>

        <div class="card">
            <strong>Test 2: Force width 600px, auto height</strong>
            <div class="mermaid-wrap">
                <div class="mermaid">
flowchart BT
    S[Bootstrap Layer]
    O[Operators Layer]
    I[Implementations]
    B[Boundary Layer]
    C[Core Abstractions]

    O --> B
    O --> C
    I --> C
    S --> O
    S --> I

    style C fill:#fff7ed,stroke:#c2410c,stroke-width:2px
    style B fill:#eff6ff,stroke:#1d4ed8,stroke-width:2px
    style O fill:#f0fdf4,stroke:#16a34a,stroke-width:2px
    style I fill:#fef3c7,stroke:#d97706,stroke-width:2px
    style S fill:#f3e8ff,stroke:#9333ea,stroke-width:2px
                </div>
            </div>
        </div>

        <div class="card">
            <strong>Test 3: Force 600x400 fixed</strong>
            <div class="mermaid-wrap">
                <div class="mermaid">
flowchart BT
    S[Bootstrap Layer]
    O[Operators Layer]
    I[Implementations]
    B[Boundary Layer]
    C[Core Abstractions]

    O --> B
    O --> C
    I --> C
    S --> O
    S --> I

    style C fill:#fff7ed,stroke:#c2410c,stroke-width:2px
    style B fill:#eff6ff,stroke:#1d4ed8,stroke-width:2px
    style O fill:#f0fdf4,stroke:#16a34a,stroke-width:2px
    style I fill:#fef3c7,stroke:#d97706,stroke-width:2px
    style S fill:#f3e8ff,stroke:#9333ea,stroke-width:2px
                </div>
            </div>
        </div>

        <div class="card">
            <strong>Test 4: Smart sizing based on viewBox aspect ratio</strong>
            <div class="mermaid-wrap">
                <div class="mermaid">
flowchart BT
    S[Bootstrap Layer]
    O[Operators Layer]
    I[Implementations]
    B[Boundary Layer]
    C[Core Abstractions]

    O --> B
    O --> C
    I --> C
    S --> O
    S --> I

    style C fill:#fff7ed,stroke:#c2410c,stroke-width:2px
    style B fill:#eff6ff,stroke:#1d4ed8,stroke-width:2px
    style O fill:#f0fdf4,stroke:#16a34a,stroke-width:2px
    style I fill:#fef3c7,stroke:#d97706,stroke-width:2px
    style S fill:#f3e8ff,stroke:#9333ea,stroke-width:2px
                </div>
            </div>
        </div>

        <div class="test-info">
            <strong>Expected:</strong> All 4 diagrams should be clearly visible and readable.
            Compare which approach gives the best result, then we'll apply it to the main documentation page.
        </div>
    </div>
</body>
</html>